（众所周知，八数码是一个计数问题）

（显然我们是不会满足于八数码的，不然暴力程序照样算得出来，所以这个问题其实是$n^2-1$数码计数问题，其中$n$为边长）

八数码问题在比赛中（往往是拼套路和手速。。。）一般以如下状态作为目标状态（$\square$代表空）（在下文中也记作标号0），通过上下左右与空交换，最先还原的为胜者（类似魔方）（事实上，找到最短路径是一个NP-hard问题，这个特性衍生出了许多篇专门找A*算法里的估价函数的论文。。。并且其在人工智能领域也有应用）

1 2 3

4 5 6

7 8 $\square$

那么，八数码问题中在给定目标状态（或者理解为初始状态）和移动（状态转移）规则的情况下，其可达状态数是多少呢？

显然，我们需要为“可达”找到一个判定条件。

事实上，萨姆·洛伊德(Sam Loyd,1841-1911)创作的“14-15”智力玩具（或者说应当是puzzle）便是一个关于十五数码问题的判定条件的puzzle，他悬赏1000美元希望有人将其还原，尽管他很清楚他永远不需要支付。。。（摘自[]）

对于这类问题，（在常规套路中）我们往往需要找到一个不变量（听说这个方法是库特·雷德马斯特(Kurt Reidemeister)在20世纪20年代发明？），而这个问题关键就是这个不变量有点。。。诡异。。。

考虑将整个布局从上至下、从左至右排列为一个行向量（对于目标状态即[1 2 3 4 5 6 7 8 0]），然后去掉0（空），计算这个得到的序列（共8个数字）的逆序对数的奇偶性即为转移不变量！

证明：

考虑0的左右交换，**由于最后把0去掉**，显然对逆序对数没影响。

考虑0的上下交换，**由于最后把0去掉**，该操作实际上即为单独“搬运”了某一个数，实际上也即与其前（或后）两(即$n-1$)个数依次交换！通过线性代数基础知识我们知道，两次交换逆序对数保持不变。

<p align="right">Q.E.D.</p>

因此，所有可能的可达状态都满足该不变量，然后充分性（满足该不变量即为可达状态）。。。QAQ。。。并不是很会证。。。大概需要去看那几篇英语论文了。。。

考虑计数，去掉0以后共8个数字，排列中逆序对数为偶数的为其一半（证明在此略过），而0可以插入到9个位置中任意一个，于是方案数$\displaystyle =\frac{8!}{2}*9=\frac{9!}{2}=\frac{(n^2)!}{2}$

那么对于一般情况下的$n$呢？易知上述证明对于$n​$为奇数的情况都是适用的。

而对于$n$为偶数的情况，上下交换会调换一次逆序对数奇偶性，因此对于某一个固定排列，对于空只有$\displaystyle \frac{n}{2}$行合法，因此总方案数为$\displaystyle (n^2-1)!*\frac{n^2}{2}=\frac{(n^2)!}{2}$（或者可以理解为不变量为(排列逆序对数+空所在行数)的奇偶性）



[1]Johnson, Wm. Woolsey; Story, William E. (1879), "Notes on the "15" Puzzle", American Journal of Mathematics, 2 (4): 397–404, doi:10.2307/2369492, ISSN 0002-9327, JSTOR 2369492

[2] [wikipedia 15-puzzle solvability](https://en.wikipedia.org/wiki/15_puzzle#Solvability)

